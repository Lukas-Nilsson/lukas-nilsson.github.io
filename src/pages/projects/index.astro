---
import { getCollection } from 'astro:content';
import ContentPage from '../../layouts/ContentPage.astro';

// Get all published project entries
const allProjects = await getCollection('public', (entry) => {
  return entry.id.startsWith('Projects/') && 
         !entry.id.includes('index.md') && 
         entry.data.publish === true;
});
---

<ContentPage title="Projects" description="Portfolio and creative works">
  <h1>Projects</h1>
  <p class="intro">A collection of projects exploring the intersection of philosophy, technology, and human potential.</p>
  
  {allProjects.length > 0 ? (
    <div class="projects-grid">
      {allProjects.map(async (project, index) => {
        const slug = project.id.replace('Projects/', '').replace('.md', '');
        const { Content } = await project.render();
        return (
          <article class="project-card" data-index={index}>
            <a href={`/projects/${slug}/`} class="project-link">
              <div class="project-card-main">
                <h3>{project.data.title || slug}</h3>
                {project.data.summary && (
                  <p>{project.data.summary}</p>
                )}
                <span class="project-arrow" aria-hidden="true">â†’</span>
              </div>
              
              <!-- Desktop hover preview -->
              <div class="project-preview" aria-hidden="true">
                <div class="project-preview-content">
                  <div class="project-preview-header">
                    <span class="project-preview-label">Preview</span>
                  </div>
                  <div class="project-preview-body">
                    {project.data.summary && <p class="preview-summary">{project.data.summary}</p>}
                    <p class="preview-hint">Click to read more â†’</p>
                  </div>
                </div>
              </div>
            </a>
          </article>
        );
      })}
    </div>
  ) : (
    <div class="empty-state">
      <div class="empty-state-icon" aria-hidden="true">ðŸ“¦</div>
      <h2 class="empty-state-title">No Projects Yet</h2>
      <p class="empty-state-text">
        Projects are currently in development. Check back soon to see what we're building.
      </p>
    </div>
  )}
</ContentPage>

<style>
  /* Following Design Philosophy: Clarity, Content First, Physics Over Linear */

  h1 {
    margin-bottom: var(--space-md);
  }

  .intro {
    color: var(--color-text-muted);
    margin-bottom: var(--space-2xl);
    font-size: var(--text-lg);
    max-width: 600px;
  }

  .projects-grid {
    display: grid;
    gap: var(--space-lg);
    margin-top: var(--space-xl);
  }

  @media (min-width: 768px) {
    .projects-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-xl);
    }
  }

  /* Project Card - Following feedback principle */
  .project-card {
    border: 1px solid var(--color-border);
    border-radius: 12px;
    overflow: hidden;
    transition: transform 200ms cubic-bezier(0.32, 0.72, 0, 1),
                border-color 200ms cubic-bezier(0.32, 0.72, 0, 1),
                box-shadow 200ms cubic-bezier(0.32, 0.72, 0, 1);
  }

  /* Staggered fade-in animation */
  .project-card {
    opacity: 0;
    transform: translateY(20px);
  }

  @media (prefers-reduced-motion: no-preference) {
    .project-card {
      animation: fadeInUp 400ms cubic-bezier(0.32, 0.72, 0, 1) forwards;
    }

    .project-card[data-index="0"] { animation-delay: 0ms; }
    .project-card[data-index="1"] { animation-delay: 100ms; }
    .project-card[data-index="2"] { animation-delay: 200ms; }
    .project-card[data-index="3"] { animation-delay: 300ms; }
  }

  @media (prefers-reduced-motion: reduce) {
    .project-card {
      opacity: 1;
      transform: none;
      animation: none;
    }
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Hover: scale + shadow (following physics principle) */
  .project-card:hover {
    transform: translateY(-4px) scale(1.01);
    border-color: var(--color-accent);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
  }

  /* Active: compress (tactile feedback) */
  .project-card:active {
    transform: translateY(-2px) scale(0.99);
  }

  /* Link wrapper */
  .project-link {
    display: block;
    color: var(--color-text);
    text-decoration: none;
    position: relative;
    -webkit-tap-highlight-color: transparent;
    overflow: hidden;
  }

  .project-card-main {
    padding: var(--space-lg);
    position: relative;
    z-index: 1;
  }

  /* Focus state (accessibility) */
  .project-link:focus-visible {
    outline: 3px solid var(--color-accent);
    outline-offset: 4px;
    border-radius: 8px;
  }

  .project-link h3 {
    font-size: var(--text-xl);
    margin-bottom: var(--space-sm);
    color: var(--color-text);
    transition: color 200ms cubic-bezier(0.32, 0.72, 0, 1);
  }

  .project-link p {
    color: var(--color-text-muted);
    font-size: var(--text-base);
    line-height: 1.6;
    margin-bottom: var(--space-md);
  }

  /* Arrow indicator (subtle affordance) */
  .project-arrow {
    display: inline-block;
    color: var(--color-accent);
    font-size: var(--text-lg);
    opacity: 0;
    transform: translateX(-10px);
    transition: all 200ms cubic-bezier(0.32, 0.72, 0, 1);
  }

  .project-card:hover .project-arrow {
    opacity: 1;
    transform: translateX(0);
  }

  .project-card:hover h3 {
    color: var(--color-accent);
  }

  /* =========================================
     DESKTOP HOVER PREVIEW
     ========================================= */
  
  .project-preview {
    position: absolute;
    inset: 0;
    background: var(--color-surface-elevated);
    opacity: 0;
    pointer-events: none;
    transform: translateY(20px);
    transition: opacity 300ms cubic-bezier(0.32, 0.72, 0, 1),
                transform 300ms cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 2;
  }

  @media (hover: hover) and (min-width: 768px) {
    .project-card:hover .project-preview {
      opacity: 1;
      transform: translateY(0);
    }

    .project-card:hover .project-card-main {
      opacity: 0;
    }
  }

  .project-preview-content {
    padding: var(--space-lg);
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .project-preview-header {
    margin-bottom: var(--space-md);
  }

  .project-preview-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-accent);
  }

  .project-preview-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .preview-summary {
    font-size: var(--text-base);
    color: var(--color-text);
    line-height: 1.7;
    margin-bottom: var(--space-md);
  }

  .preview-hint {
    font-size: var(--text-sm);
    color: var(--color-accent);
    font-weight: 500;
    margin-top: auto;
  }

  /* Hide preview on mobile */
  @media (hover: none) or (max-width: 767px) {
    .project-preview {
      display: none;
    }
  }

  /* =========================================
     EMPTY STATE (Elegant fallback)
     ========================================= */
  
  .empty-state {
    text-align: center;
    padding: var(--space-3xl) var(--space-lg);
    margin: var(--space-2xl) 0;
  }

  .empty-state-icon {
    font-size: 4rem;
    margin-bottom: var(--space-lg);
    opacity: 0;
    transform: scale(0.8);
    animation: fadeInScale 400ms cubic-bezier(0.32, 0.72, 0, 1) 200ms forwards;
  }

  @keyframes fadeInScale {
    to {
      opacity: 0.6;
      transform: scale(1);
    }
  }

  .empty-state-title {
    font-size: var(--text-2xl);
    color: var(--color-text);
    margin-bottom: var(--space-md);
    opacity: 0;
    animation: fadeInUp 400ms cubic-bezier(0.32, 0.72, 0, 1) 300ms forwards;
  }

  .empty-state-text {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    max-width: 500px;
    margin: 0 auto;
    opacity: 0;
    animation: fadeInUp 400ms cubic-bezier(0.32, 0.72, 0, 1) 400ms forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    .empty-state-icon,
    .empty-state-title,
    .empty-state-text {
      opacity: 1;
      transform: none;
      animation: none;
    }
    
    .empty-state-icon {
      opacity: 0.6;
    }
  }
</style>

